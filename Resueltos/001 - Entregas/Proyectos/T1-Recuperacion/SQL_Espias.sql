DROP SCHEMA IF EXISTS SQL_ESPIAS;
CREATE SCHEMA SQL_ESPIAS;
USE SQL_ESPIAS;



CREATE TABLE REGION (
	NOMBRE_REGION VARCHAR(50) PRIMARY KEY,
    DESCRIPCION TEXT(500),
    SUPERFICIE_TOTAL INT
);

INSERT INTO REGION (NOMBRE_REGION, DESCRIPCION, SUPERFICIE_TOTAL)
VALUES
    ('Europa', 'Continente diverso con rica historia y cultura.', 10180000),
    ('Norteamérica', 'Región que incluye América del Norte, con diversas geografías.', 24709000),
    ('Asia', 'El continente más grande y poblado, con una amplia variedad cultural.', 44579000);


CREATE TABLE PAIS (
	NOMBRE_PAIS VARCHAR(50) PRIMARY KEY,
	DESCRIPCION TEXT(500),
	SUPERFICIE_TOTAL INT,
	MONEDA VARCHAR(30),
	POB_TOTAL INT,
    NOMBRE_REGION VARCHAR(50),
    
    FOREIGN KEY (NOMBRE_REGION) REFERENCES REGION(NOMBRE_REGION)
);
    
INSERT INTO PAIS (NOMBRE_PAIS, DESCRIPCION, SUPERFICIE_TOTAL, MONEDA, POB_TOTAL, NOMBRE_REGION)
VALUES
    ('Francia', 'País en Europa occidental conocido por su cultura y gastronomía.', 551695, 'Euro', 67200000, 'Europa'),
    ('Estados Unidos', 'País en Norteamérica con diversidad cultural y geográfica.', 9833517, 'Dólar estadounidense', 331002651, 'Norteamérica'),
    ('Japón', 'Nación insular en Asia oriental con una rica historia y tecnología avanzada.', 377975, 'Yen', 126476461, 'Asia');
    
CREATE TABLE LUGAR (
	NOMBRE_LUGAR VARCHAR(50) PRIMARY KEY,
	DESCRIPCION TEXT(500),
	LATITUD INT,
	LONGITUD INT,
	NOMBRE_PAIS VARCHAR(50),

	FOREIGN KEY (NOMBRE_PAIS) REFERENCES PAIS(NOMBRE_PAIS),
    CONSTRAINT LATITUD_CORRECTA CHECK (LATITUD BETWEEN -90 AND 90) 
);

INSERT INTO LUGAR (NOMBRE_LUGAR, DESCRIPCION, LATITUD, LONGITUD, NOMBRE_PAIS)
VALUES
    ('Torre Eiffel', 'Famosa torre de hierro en París, Francia.', 48.858844, 2.294350, 'Francia'),
    ('Estados Unidos Capitolio', 'Sede del Congreso de los Estados Unidos en Washington, D.C.', 38.889939, -77.009051, 'Estados Unidos'),
    ('Monte Fuji', 'Montaña icónica en Japón, un volcán activo.', 35.360556, 138.727778, 'Japón');


CREATE TABLE AGENCIA (
	NOMBRE_AGENCIA VARCHAR(50) PRIMARY KEY,
    DESCRIPCION TEXT(500)
    
);

INSERT INTO AGENCIA (NOMBRE_AGENCIA, DESCRIPCION)
VALUES
    ('MI6', 'Agencia de inteligencia británica especializada en operaciones encubiertas y contraespionaje.'),
    ('CIA', 'Agencia de inteligencia de los Estados Unidos encargada de la seguridad nacional.'),
    ('MSS', 'Ministerio de Seguridad del Estado de la República Popular China, responsable de la inteligencia y seguridad interna.');


CREATE TABLE ESPIA (
	ID_ESPIA INT PRIMARY KEY AUTO_INCREMENT UNIQUE,
    NOMBRE_ESPIA VARCHAR(50),
    F_NACIMIENTO DATE DEFAULT "1901-01-01",
    EMAIL VARCHAR(100) UNIQUE,
    F_RECLUTAMIENTO DATE,
    F_ULT_MOVIMIENTO DATE,
    NOMBRE_LUGAR VARCHAR(50),
    
    FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE_LUGAR),
    CONSTRAINT F_NACIMIENTO_CORRECTO CHECK (F_NACIMIENTO < "2005-12-01"),
    CONSTRAINT EMAIL_CORRECTO CHECK (EMAIL LIKE '%_@_%._%'),
    CONSTRAINT ULT_MOVIMIENTO_VALIDO CHECK (F_ULT_MOVIMIENTO = F_RECLUTAMIENTO OR F_ULT_MOVIMIENTO > F_RECLUTAMIENTO )
    
);

INSERT INTO ESPIA (NOMBRE_ESPIA, F_NACIMIENTO, EMAIL, F_RECLUTAMIENTO, F_ULT_MOVIMIENTO, NOMBRE_LUGAR)
VALUES
    ('Eva Green', '1980-07-05', 'eva.green@mi6.com', '2005-12-15', '2024-01-10', 'Torre Eiffel'),
    ('Tom Cruise', '1972-07-03', 'tom.cruise@cia.gov', '2000-05-20', '2024-01-10', 'Monte Fuji'),
    ('Zhang Ziyi', '1979-02-09', 'zhang.ziyi@mss.gov.cn', '2008-10-15', '2024-01-10', 'Estados Unidos Capitolio');



CREATE TABLE MISION (

	ID_MISION INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR(50),
    DESCRIPCION TEXT(500),
    RECOMPENSA INT,
    F_LIMITE DATE,
    ID_ESPIA INT,

	FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA)
);

INSERT INTO MISION (NOMBRE, DESCRIPCION, RECOMPENSA, F_LIMITE, ID_ESPIA)
VALUES
    ('Operación Fénix', 'Infiltrarse en una base enemiga y recuperar información confidencial.', 1000000, '2024-12-31', 1),
    ('Proyecto Eclipse', 'Desactivar un dispositivo nuclear oculto en la selva.', 1500000, '2025-06-30', 2),
    ('Operación Dragón', 'Infiltrarse en una organización criminal y desmantelar sus operaciones.', 1200000, '2024-11-15', 3);

CREATE TABLE ESTADO_MISION (
	
    ID_MISION INT AUTO_INCREMENT,
    COMPLETO_ACTUAL_FALLADA TINYTEXT,
    F_ESTADO DATE,
    
    PRIMARY KEY (ID_MISION),
    FOREIGN KEY (ID_MISION) REFERENCES MISION(ID_MISION),
    CONSTRAINT ESTADO_MISION CHECK (COMPLETO_ACTUAL_FALLADA IN ("COMPLETADA","ACTIVA","FALLIDA"))    
    );
   
INSERT INTO ESTADO_MISION (ID_MISION, COMPLETO_ACTUAL_FALLADA, F_ESTADO)
VALUES
    (1, 'ACTIVA', '2024-01-10'),
    (2, 'COMPLETADA', '2024-06-15'),
    (3, 'FALLIDA', '2024-03-05');
    
    
CREATE TABLE CIUDAD (
	NOMBRE_LUGAR VARCHAR(50),
    NOMBRE_CIUDAD VARCHAR(50),
    POB_TOTAL INT,
    F_FUNDACION DATE,
    C_POSTAL INT,
    SALARIOMEDIO INT,
    
	PRIMARY KEY (NOMBRE_LUGAR),
    FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE_LUGAR)
);

INSERT INTO CIUDAD (NOMBRE_LUGAR, NOMBRE_CIUDAD, POB_TOTAL, F_FUNDACION, C_POSTAL, SALARIOMEDIO)
VALUES
    ('Monte Fuji', "Tokio", 2140526, '1200-01-01', 56000, 50000),
    ('Estados Unidos Capitolio', "Washington", 8336817, '1624-01-01', 10001, 75000),
    ('Torre Eiffel', "Paris", 21723000, '723-01-01', 13000, 60000);

CREATE TABLE CAMPO (
	NOMBRE_LUGAR VARCHAR(50),
    TEMP_MEDIA DECIMAL(5,1),
    T_VEGETACION TINYTEXT,
    PRECIP_ANUAL INT,
    
	PRIMARY KEY (NOMBRE_LUGAR),
    FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE_LUGAR)
);

INSERT INTO CAMPO (NOMBRE_LUGAR, TEMP_MEDIA, T_VEGETACION, PRECIP_ANUAL)
VALUES
    ('Monte Fuji', 12.3, 'Bosque caducifolio', 800),
    ('Estados Unidos Capitolio', 20.5, 'Desierto', 300),
    ('Torre Eiffel', 18.9, 'Bosque subtropical', 1200);

CREATE TABLE EDIFICIO (
	NOMBRE_LUGAR VARCHAR(50),
	CALLE TINYTEXT,
    NUMERO SMALLINT,
    F_CONSTRUCCION DATE,
	
	PRIMARY KEY (NOMBRE_LUGAR),
    FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE_LUGAR)
);

INSERT INTO EDIFICIO (NOMBRE_LUGAR, CALLE, NUMERO, F_CONSTRUCCION)
VALUES
    ('Torre Eiffel', 'Champ de Mars', 5, '1889-03-31'),
    ('Estados Unidos Capitolio', 'Fifth Avenue', 350, '1931-05-01'),
    ('Monte Fuji', 'No aplica', NULL, NULL);


CREATE TABLE LIDER (
	ID_ESPIA INT,
    
	PRIMARY KEY (ID_ESPIA),
    FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA)
);

INSERT INTO LIDER (ID_ESPIA)
VALUES
    (1), -- Supongamos que James Bond es el líder
    (2),
    (3);
    
CREATE TABLE MIEMBRO (
	ID_ESPIA INT,
    
	PRIMARY KEY (ID_ESPIA),
    FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA)
);

INSERT INTO MIEMBRO (ID_ESPIA)
VALUES
    (1),
    (2),
    (3);
    
CREATE TABLE ASESINO (
	ID_ESPIA INT,
    T_RESPIRACION SMALLINT,
    PULSACIONES TINYINT,
	MAX_DIST INT,
    
	PRIMARY KEY (ID_ESPIA),
    FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA)
);

INSERT INTO ASESINO (ID_ESPIA, T_RESPIRACION, PULSACIONES, MAX_DIST)
VALUES
    (1, 18, 60, 500), -- Supongamos que el espía con ID_ESPIA 1 es un asesino
    (2, 20, 70, 800), -- Supongamos que el espía con ID_ESPIA 2 es otro asesino
    (3, 15, 55, 400); -- Supongamos que el espía con ID_ESPIA 3 también es un asesino


CREATE TABLE PLANTA (
	ID_PLANTA INT PRIMARY KEY AUTO_INCREMENT,
    N_PLANTA TINYINT,
    ALTURA INT,
    NOMBRE_LUGAR VARCHAR(50),
    
    FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE_LUGAR)
);

INSERT INTO PLANTA (N_PLANTA, ALTURA, NOMBRE_LUGAR)
VALUES
    (12, 50, 'Torre Eiffel'),
    (5, 30, 'Estados Unidos Capitolio'),
    (6, 80, 'Monte Fuji'); 


CREATE TABLE HABITACION (
	ID_HABITACION INT PRIMARY KEY AUTO_INCREMENT,
    TAMANO TINYTEXT,
    S_CALLE TINYTEXT,
    ID_PLANTA INT,

	FOREIGN KEY (ID_PLANTA) REFERENCES PLANTA(ID_PLANTA)
);

INSERT INTO HABITACION (TAMANO, S_CALLE, ID_PLANTA)
VALUES
    ('Grande', 'Avenida Principal', 1), 
    ('Mediana', 'Calle Tranquila', 2),
    ('Pequeña', 'Calle Residencial', 3);


CREATE TABLE EQUIPO (
	ID_EQUIPO INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    PRECIO DECIMAL(9,2) NOT NULL,
    DESCRIPCION TEXT(500) NOT NULL,
    ES_ARMA BOOLEAN NOT NULL,
    PESO DECIMAL(3,2) NOT NULL
    
);

INSERT INTO EQUIPO (PRECIO, DESCRIPCION, ES_ARMA, PESO)
VALUES
    (150.99, 'Chaleco antibalas', false, 3.5),
    (499.50, 'Pistola semiautomática', true, 1.2),
    (999.00, 'Rifle de francotirador', true, 8.7);

CREATE TABLE EMPRESA (
	NIF_EMPRESA CHAR(9) PRIMARY KEY UNIQUE,
    N_FISCAL TINYTEXT,
    N_COMERCIAL TINYTEXT,
    F_FUNDACION DATE,
    FACTURACION INT,
    NOMBRE_PAIS VARCHAR(50),
    
    FOREIGN KEY (NOMBRE_PAIS) REFERENCES PAIS(NOMBRE_PAIS),
    CONSTRAINT NIF_VALIDO CHECK (NIF_EMPRESA RLIKE "[0-9]{8}[X-Z]")
);

INSERT INTO EMPRESA (NIF_EMPRESA, N_FISCAL, N_COMERCIAL, F_FUNDACION, FACTURACION, NOMBRE_PAIS)
VALUES
    ('12345678X', 'ES012345678', 'Empresa A', '1990-05-20', 5000000, 'Japon'),
    ('98765432Y', 'ES098765432', 'Empresa B', '1985-11-15', 8000000, 'Francia'),
    ('56789012Z', 'ES056789012', 'Empresa C', '2000-03-10', 3000000, 'Estados Unidos');

CREATE TABLE CIVIL (
	ID_CIVIL INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR(50),
    EDAD SMALLINT DEFAULT "40",
    SEXO TINYTEXT,
    DESCRIPCION TEXT(500),
    ESTATURA DECIMAL(3,2),
    C_PELO TINYTEXT,
    NOMBRE_LUGAR VARCHAR(50),
    
    FOREIGN KEY (NOMBRE_LUGAR) REFERENCES LUGAR(NOMBRE_LUGAR),
    CONSTRAINT EDAD_CORRECTA CHECK (EDAD BETWEEN 30 AND 80)
);

INSERT INTO CIVIL (NOMBRE, EDAD, SEXO, DESCRIPCION, ESTATURA, C_PELO, NOMBRE_LUGAR)
VALUES
    ('Ana García', 45, 'Femenino', 'Médico residente, apasionada por la música clásica.', 1.68, 'Castano', 'Torre Eiffel'),
    ('John Smith', 32, 'Masculino', 'Ingeniero de software, aficionado al senderismo.', 1.78, 'Rubio', 'Estados Unidos Capitolio'),
    ('Luisa Rodríguez', 55, 'Femenino', 'Jubilada, amante de la jardinería y la pintura.', 1.60, 'Negro', 'Monte Fuji');

CREATE TABLE POLITICO (
	ID_CIVIL INT,
    CARGO TINYTEXT,
    PARTIDO TINYTEXT,
    
    PRIMARY KEY (ID_CIVIL),
    FOREIGN KEY (ID_CIVIL) REFERENCES CIVIL(ID_CIVIL)
);

INSERT INTO POLITICO (ID_CIVIL, CARGO, PARTIDO)
VALUES
    (1, 'Concejal', 'Partido Popular'),
    (3, 'Senadora', 'Partido Socialista Obrero Español'),
    (2, 'Representante', 'Partido Demócrata'); 

CREATE TABLE EMPRESARIO (
	ID_CIVIL INT,
    VAL_PATRIMONIO INT,
    GUARDAESPALDAS BOOLEAN,
    NIF_EMPRESA CHAR(9),
    
    PRIMARY KEY (ID_CIVIL),
	FOREIGN KEY (ID_CIVIL) REFERENCES CIVIL(ID_CIVIL),
    FOREIGN KEY (NIF_EMPRESA) REFERENCES EMPRESA(NIF_EMPRESA)
);

INSERT INTO EMPRESARIO (ID_CIVIL, VAL_PATRIMONIO, GUARDAESPALDAS, NIF_EMPRESA)
VALUES
    (1, 15000000, true, '12345678X'), -- Asociamos a Ana García con un patrimonio de 15 millones y un guardaespaldas
    (2, 30000000, true, '98765432Y'), -- Asociamos a John Smith con un patrimonio de 30 millones y un guardaespaldas
    (3, 5000000, false, '56789012Z'); -- Asociamos a Luisa Rodríguez con un patrimonio de 5 millones y sin guardaespaldas

CREATE TABLE EMPRESA_FABRICA_EQUIPO (
	NIF_EMPRESA CHAR(9),
    ID_EQUIPO INT,
    
    PRIMARY KEY (NIF_EMPRESA,ID_EQUIPO),
    FOREIGN KEY (NIF_EMPRESA) REFERENCES EMPRESA(NIF_EMPRESA),
    FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO(ID_EQUIPO)
);

INSERT INTO EMPRESA_FABRICA_EQUIPO (NIF_EMPRESA, ID_EQUIPO)
VALUES
    ('12345678X', 1), -- Empresa A fabrica el Chaleco antibalas
    ('98765432Y', 2), -- Empresa B fabrica la Pistola semiautomática
    ('56789012Z', 3); -- Empresa C fabrica la Granada de fragmentación

CREATE TABLE ESPIA_SABE_USAR_EQUIPO (
	ID_ESPIA INT,
	ID_EQUIPO INT,
    
    PRIMARY KEY (ID_ESPIA,ID_EQUIPO),
    FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA),
    FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO(ID_EQUIPO)
);

INSERT INTO ESPIA_SABE_USAR_EQUIPO (ID_ESPIA, ID_EQUIPO)
VALUES
    (1, 1),
    (2, 2),
    (3, 3);

CREATE TABLE ASESINO_ELIMINA_POLITICO_CON_EQUIPO (
	ID_ESPIA INT,
    ID_CIVIL INT,
    ID_EQUIPO INT,
    FECHAHORA DATETIME,
    
    PRIMARY KEY (ID_ESPIA,ID_EQUIPO,ID_CIVIL),
    FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA),
    FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO(ID_EQUIPO),
    FOREIGN KEY (ID_CIVIL) REFERENCES CIVIL(ID_CIVIL)
);

INSERT INTO ASESINO_ELIMINA_POLITICO_CON_EQUIPO (ID_ESPIA, ID_EQUIPO, ID_CIVIL, FECHAHORA)
VALUES
    (2, 2, 1, '2024-01-10 08:30:00'),
    (3, 3, 3, '2024-01-11 15:45:00'), 
    (1, 1, 2, '2024-01-09 22:00:00'); 

CREATE TABLE ESPIA_PRESTA_EQUIPO_ESPIA (
	ID_ESPIA1 INT,
    ID_ESPIA2 INT,
    ID_EQUIPO INT,

    PRIMARY KEY (ID_ESPIA1,ID_ESPIA2,ID_EQUIPO),
    FOREIGN KEY (ID_ESPIA1) REFERENCES ESPIA(ID_ESPIA),
    FOREIGN KEY (ID_ESPIA2) REFERENCES ESPIA(ID_ESPIA),
    FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO(ID_EQUIPO)
);

INSERT INTO ESPIA_PRESTA_EQUIPO_ESPIA (ID_ESPIA1, ID_ESPIA2, ID_EQUIPO)
VALUES
    (1, 3, 1),
    (2, 1, 2), 
    (3, 2, 3); 

CREATE TABLE AGENCIA_COLABORA_AGENCIA (
	NOMBRE_AGENCIA1 VARCHAR(50),
    NOMBRE_AGENCIA2 VARCHAR(50),
    F_INICIO DATE,
    F_FIN DATE,
    ID_ESPIA INT,
	
    PRIMARY KEY (NOMBRE_AGENCIA1,NOMBRE_AGENCIA2,ID_ESPIA),
    FOREIGN KEY (NOMBRE_AGENCIA1) REFERENCES AGENCIA(NOMBRE_AGENCIA),
    FOREIGN KEY (NOMBRE_AGENCIA2) REFERENCES AGENCIA(NOMBRE_AGENCIA),
    FOREIGN KEY (ID_ESPIA) REFERENCES ESPIA(ID_ESPIA),
    CONSTRAINT FECHAS_CORRECTAS CHECK (F_FIN > F_INICIO)
);

INSERT INTO AGENCIA_COLABORA_AGENCIA (NOMBRE_AGENCIA1, NOMBRE_AGENCIA2, F_INICIO, F_FIN, ID_ESPIA)
VALUES
    ('MI6', 'CIA', '2024-01-10', '2024-12-31', 1),
    ('CIA', 'MSS', '2024-02-15', '2024-11-30', 3),
    ('MSS', 'MI6', '2024-03-20', '2024-10-15', 2);

CREATE TABLE AGENCIA_POSEE_EQUIPO_EMPRESA (
	ID_EQUIPO INT,
    NOMBRE_AGENCIA VARCHAR(50),
    PRECIOCOMPRA DECIMAL(8,2),
    FECHACOMPRA DATE,
    UNIDADES INT,
    
    PRIMARY KEY (ID_EQUIPO,NOMBRE_AGENCIA),
    FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO(ID_EQUIPO),
    FOREIGN KEY (NOMBRE_AGENCIA) REFERENCES AGENCIA(NOMBRE_AGENCIA),
    CONSTRAINT COMPRA_MINIMA CHECK (UNIDADES>0)
);

INSERT INTO AGENCIA_POSEE_EQUIPO_EMPRESA (ID_EQUIPO, NOMBRE_AGENCIA, PRECIOCOMPRA, FECHACOMPRA, UNIDADES)
VALUES
    (1, 'MI6', 5000.00, '2024-01-15', 10), -- MI6 compra 10 Chalecos antibalas
    (2, 'CIA', 8000.00, '2024-02-20', 5), -- CIA compra 5 Pistolas semiautomáticas
    (3, 'MSS', 12000.00, '2024-03-25', 3); -- MSS compra 3 Granadas de fragmentación

CREATE TABLE CIUDAD_CONECTA_CIUDAD (
	NOMBRE_LUGAR1 VARCHAR(50),
    NOMBRE_LUGAR2 VARCHAR(50),
    
    FOREIGN KEY (NOMBRE_LUGAR1) REFERENCES LUGAR(NOMBRE_LUGAR),
	FOREIGN KEY (NOMBRE_LUGAR2) REFERENCES LUGAR(NOMBRE_LUGAR),
    PRIMARY KEY (NOMBRE_LUGAR1,NOMBRE_LUGAR2)

);

INSERT INTO CIUDAD_CONECTA_CIUDAD (NOMBRE_LUGAR1, NOMBRE_LUGAR2)
VALUES
    ('Torre Eiffel', 'Estados Unidos Capitolio'),
    ('Monte Fuji', 'Torre Eiffel'), 
    ('Estados Unidos Capitolio', 'Monte Fuji'); 

    